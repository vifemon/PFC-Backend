<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro-form</title>
    <style>
        .mensaje-error {
            color: red;
            font-size: 14px;
            margin-top: 5px;
        }
        .reg-success {
            display: none;
        }
    </style>
</head>

<body>
    <label for="usuario">Nombre de usuario:</label>
    <input type="text" id="usuario">
    <span id="errorUsuario" class="mensaje-error"></span>
    <br>
    <label for="nombre">Nombre:</label>
    <input type="text" name="" id="nombre">
    <span id="errorNombre" class="mensaje-error"></span>
    <br>
    <label for="apellidos">Apellidos:</label>
    <input type="text" name="" id="apellidos">
    <span id="errorApellidos" class="mensaje-error"></span>
    <br>
    <label for="email">Email:</label>
    <input type="text" name="" id="email">
    <span id="errorEmail" class="mensaje-error"></span>
    <br>
    <label for="telefono">Telefono:</label>
    <input type="text" name="" id="telefono">
    <span id="errorTelefono" class="mensaje-error"></span>
    <br>
    <label for="password1">Contraseña:</label>
    <input type="password" name="" id="password1">
    <br>
    <label for="password2">Repite la contraseña:</label>
    <input type="password" name="" id="password2">
    <span id="errorPassword" class="mensaje-error"></span>
    <br>
    <input type="button" value="Registrar" onClick="validar()">
    <div id="reg-success" class="reg-success">
        <span id="registro-mensaje"></span>
        <input type="button" onclick="location.href='login.html'" value="Ve a Login">
    </div>

    <script>

        function validar() {
            let usuario = document.getElementById("usuario").value;
            let nombre = document.getElementById("nombre").value;
            let apellidos = document.getElementById("apellidos").value;
            let email = document.getElementById("email").value;
            let emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            let telefono = document.getElementById("telefono").value;
            let telefonoRegex = /^(\+34|0034|34)?[6789]\d{8}$/;
            let password1 = document.getElementById("password1").value;
            let password2 = document.getElementById("password2").value;
            let isValid = true

            if (usuario.length <= 2) {
                document.getElementById("errorUsuario").innerHTML = "Usuario debe ser más largo";
                isValid = false;
            } else {
                document.getElementById("errorUsuario").innerHTML = "";
            }
            if (nombre.length <= 2) {
                document.getElementById("errorNombre").innerHTML = "Debe ser un nombre real";
                isValid = false;
            } else {
                document.getElementById("errorNombre").innerHTML = "";
            }
            if (apellidos.length <= 1) {
                document.getElementById("errorApellidos").innerHTML = "Debes introducir aprellidos";
                isValid = false;
            } else {
                document.getElementById("errorApellidos").innerHTML = "";
            }
            if (emailRegex.test(email)) {
                document.getElementById("errorEmail").innerHTML = "";
            } else {
                document.getElementById("errorEmail").innerHTML = "Email inválido"
                isValid = false;
            }
            if (telefonoRegex.test(telefono)) {
                document.getElementById("errorTelefono").innerHTML = "";
            } else {
                document.getElementById("errorTelefono").innerHTML = "Teléfono inválido"
                isValid = false;
            }
            if (password1.length <= 5 || password2.length <= 5) {
                document.getElementById("errorPassword").innerHTML = "Contraseña debe ser mayor de 5 digitos"
                isValid = false;
            } else if (password1 !== password2) {
                document.getElementById("errorPassword").innerHTML = "Las contraseñas no coinciden"
                isValid = false;
            } else {
                document.getElementById("errorPassword").innerHTML = ""
            }

            if (isValid) {
              

                let peticio_http = new XMLHttpRequest();
                peticio_http.open('POST', 'registro-insert.php', true);
                peticio_http.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                peticio_http.send('usuario=' + usuario+'&nombre='+nombre+'&apellidos='+apellidos+'&email='+email+'&telefono='+telefono+'&password='+password1);
                peticio_http.onreadystatechange = function () {
                    if (peticio_http.readyState == 4) {
                        if (peticio_http.status == 200) {
                            console.log(peticio_http.responseText)
                            let response = JSON.parse(peticio_http.responseText)
                            if (response.status = "success"){
                            document.getElementById("registro-mensaje").innerHTML = "Registro correcto";
                            }
                            document.getElementById("reg-success").style.display = "block";


                        }
                    }

                }



            }

        }

    </script>
</body>

</html>